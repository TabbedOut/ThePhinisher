@(compositeID: Long, title: String, 
	tasks: List[Burndowns.Task], 
	phabUrl:String, 
	totalHours:Long,
	hasPrevious: Boolean
	) 

@main("Burn it all down") {

	@* Scripts *@
	
	<script>
		$(document).ready(function() {
			var saveSuccess = function(data, status, jqXHR) {
				$("#saveBurndown").hide();
				$("#saveBurndownMessage").text("Saved");
			};
			
			var saveFailure = function(jqXHR, status, error) {
				alert("failure: " + status + " " + error);
			}
			
			var saveBurndownOverAjax = function() {
				 jsRoutes.controllers.Burndowns.saveSnapshotViaAjax(@{compositeID}).ajax({
					 data : JSON.stringify("{}"),
					 contentType : 'application/json'
				 })
				  .done( saveSuccess )
				  .fail( saveFailure );
			};

			$("#saveConfirmed").click(function(){
				saveBurndownOverAjax();
			});
		
		});
	</script>
	
 } {

@* Content *@

<div class="container">

	<ol class="breadcrumb">
  		<li><a href="@routes.Burndowns.index">Burndowns Home</a></li>
  		<li class="active">Current Burndown</li>
	</ol>

	<div class="row">
		<div class="col-md-1">
			<h1>@{compositeID}</h1>
		</div>
		<div class="col-md-11"><h1>@title</h1>
		</div>
	</div>
	<div class="row">
		@* This is a bad idea
		<div class="col-md-2">
		 	<button id="openAllTasks" type="submit" class="btn btn-info">Open Tasks New Tabs</button>
		</div> 
		
		*@
		<div class="col-md-2">
		 	<button id="saveBurndown" type="submit" class="btn btn-info" data-toggle="modal" data-target="#saveConfirmation">
		 		<span class="glyphicon glyphicon-floppy-disk"></span>
		 	Save Snapshot</button>
		 	<span id="saveBurndownMessage"></span>
		</div>
		<div class="col-md-2">
			@if(hasPrevious) {
			 <a href="@routes.Burndowns.burndownData(compositeID.toString)">Previous Burndowns</a>
			}
		</div>
	</div>
	<div class="row">
		<div class="col-md-2">
		&nbsp;
		</div>
	</div>
	<div class="row">
		<div class="col-md-12">
			<table class="table">
				<tr>
					<th>Total Hours</th>
					<th>Total Days</th>
				</tr>
				<tr>
					<td>@totalHours</td>
					<td>@{totalHours / 8}</td>
				</tr>
			</table>
		</div>
	</div>
	<div class="row">
		
	
		<div class="col-md-12">
			<table class="table">
				<tr>
					<th></th>
					<th>Task</th>
					<th>Est. Hours</th>
					<th>Title</th>
					<th>Assignee</th>
				</tr>
				@for(task <- tasks) {
			
				<tr id="taskRow@{task.taskID}" class="@if(task.priority==90 || task.hours.isEmpty){needsTriage}">
					<td>
						<button type="button" class="btn btn-xs btn-success" id="hide@{task.taskID}">
							<span class="glyphicon glyphicon-ok-circle"></span>
						</button>
					</td>
					<td><a href="@{phabUrl + task.taskID}">@{task.taskID}</a></td>
					<td>@{task.hours.getOrElse("n/a")}</td>
					<td>@{task.title}</td>
					<td>@{task.assignee}</td>
				</tr>
				<script>
					$("#hide@{task.taskID}").click(function(){
						$("#taskRow@{task.taskID}").addClass("finishedRow");
					})
				</script>
				}
				
			</table>
		</div>
	</div>
</div>

	<div class="modal fade" id="saveConfirmation" tabindex="-1" role="dialog" aria-labelledby="saveConfirmTitle" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
	        <h4 class="modal-title" id="saveConfirmTitle">Save Burndown?</h4>
	      </div>
	      <div class="modal-body">
	        <p>Would you like to save this burndown? There is no way to remove a burndown once saved.</p>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
	        <button type="button" class="btn btn-primary" id="saveConfirmed" data-dismiss="modal">Save burndown</button>
	      </div>
	    </div> 
	  </div> 
	</div> 
} 
